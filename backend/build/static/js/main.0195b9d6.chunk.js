(this.webpackJsonpviews=this.webpackJsonpviews||[]).push([[0],{27:function(e,t,a){},37:function(e,t,a){e.exports=a(59)},5:function(e,t,a){var n=a(43);a(46),a(48);n.initializeApp({apiKey:"AIzaSyABr6Z9iTrM62xpqWWnno-P2fiPVMBj5eA",authDomain:"mitranetra-1234.firebaseapp.com",databaseURL:"https://mitranetra-1234.firebaseio.com",projectId:"mitranetra-1234",storageBucket:"mitranetra-1234.appspot.com",messagingSenderId:"10603497416",appId:"1:10603497416:web:db504911852f1f519122fd",measurementId:"G-KRXRPY012G"}),e.exports=n},59:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),u=a(28),i=a.n(u),s=a(17),l=a(29),c=a(2),o=a(30),m=Object(n.createContext)(),d=function(e){var t=e.children,a=Object(n.useState)({data:{}}),u=Object(c.a)(a,2),i=u[0],s=u[1],l=Object(n.useState)(!1),o=Object(c.a)(l,2),d=o[0],f=o[1],p=Object(n.useState)(!1),b=Object(c.a)(p,2),h=b[0],g=b[1];return r.a.createElement(m.Provider,{value:{results:i,fetched:d,isLoading:h,getData:function(e,t){if(""===t)return null;g(!0),fetch(e(t)).then((function(e){return e.json()})).then((function(e){s({data:e}),f(!0),g(!1)})).catch((function(e){console.log(e)}))}}},t)},f=function(){var e=Object(n.useContext)(m),t=e.results,a=e.isLoading,u=e.fetched,i=t.data.totalItems,s="";a?s="loading...":u&&!a&&(s=0===i?"Pencarian tidak ditemukan":"ditemukan ".concat(i," hasil"));var l=Object(n.useRef)();return Object(n.useEffect)((function(){return l.current.focus()}),[s]),r.a.createElement("span",{"aria-live":"polite",ref:l,tabIndex:0},s)},p=a(3),b=a.n(p),h=a(6),g=a(5),E=a.n(g),v={uid:"",email:"",emailVerified:!1,role:""},k=Object(n.createContext)(v),j=function(e){var t=e.children,a=Object(n.useState)(v),u=Object(c.a)(a,2),i=u[0],s=u[1],l=Object(n.useState)(!1),o=Object(c.a)(l,2),m=o[0],d=o[1],f=Object(n.useState)(!1),p=Object(c.a)(f,2),g=p[0],j=p[1],O=Object(n.useState)(""),y=Object(c.a)(O,2),S=y[0],w=y[1],x=Object(n.useState)([]),C=Object(c.a)(x,2),q=C[0],R=C[1],I=function(){var e=Object(h.a)(b.a.mark((function e(t,a,n){var r,u;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat("https://us-central1-mitranetra-1234.cloudfunctions.net/app","/api/users"),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:a,sendEmailVerification:n})});case 3:return r=e.sent,e.next=6,r.json();case 6:"success"===(u=e.sent).status?(w("success"),L(t,a)):w(u.err.message),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log("error while connecting to server:",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,a,n){return e.apply(this,arguments)}}(),L=function(e,t){E.a.auth().signInWithEmailAndPassword(e,t).then((function(){w("success"),j(!0)})).catch((function(e){return w(e.message)}))},A=function(e){try{console.log(e),E.a.firestore().collection("users").doc(e).onSnapshot((function(e){if(!e.exists)return console.log("request list is empty");var t=e.data().requestList;R(t)}))}catch(t){console.log(t)}};return r.a.createElement(k.Provider,{value:{userStatus:i,authCheckDone:g,registerOnServer:I,isSignedIn:m,signIn:L,signOut:function(){return E.a.auth().signOut().then((function(){return console.log("sign out success")}),(function(e){return console.log(e),{err:e}}))},checkUserStatus:function(){E.a.auth().onAuthStateChanged((function(e){e?(console.log(e.uid),e.getIdTokenResult().then((function(t){t.claims.admin?(console.log("user is admin"),s({uid:e.uid,email:e.email,emailVerified:e.emailVerified,role:"admin"})):(console.log("user is a basic user"),s({uid:e.uid,email:e.email,emailVerified:e.emailVerified,role:""}))})),A(e.uid),d(!0)):(d(!1),s({uid:"",email:"",emailVerified:!1,role:""}),console.log(i.uid))})),j(!0)},register:function(e,t){E.a.auth().createUserWithEmailAndPassword(e,t).then((function(){return w("success")})).catch((function(e){w(e.message)}))},alertMessage:S,getRequestList:A,requestList:q,setAlert:w}},t)},O=function(e){var t=e.bookInfo,a=Object(n.useContext)(k),u=a.userStatus,i=a.requestList,s=a.isSignedIn,l=Object(n.useState)(t.voteSum),o=Object(c.a)(l,2),m=o[0],d=o[1],f=(E.a.firestore().collection("buku").doc(t.id),Object(n.useState)(!1)),p=Object(c.a)(f,2),g=p[0],v=p[1],j=function(){var e=Object(h.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}return e.abrupt("return",alert("Anda harus  Sign In sebelum request buku!"));case 2:if(!g){e.next=9;break}return e.next=5,O("remove-vote");case 5:"success"===e.sent&&d(m-1),e.next=13;break;case 9:return e.next=11,O("add-vote");case 11:"success"===e.sent&&d(m+1);case 13:v(!g);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=Object(h.a)(b.a.mark((function e(a){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat("https://us-central1-mitranetra-1234.cloudfunctions.net/app","/api/").concat(a),{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify({uid:u.uid,book:t})});case 3:return n=e.sent,e.next=6,n.json();case 6:return e.abrupt("return",e.sent);case 9:e.prev=9,e.t0=e.catch(0),console.log("".concat(a," failed"),e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){v(i.includes(t.id)),s||v(!1)}),[i,s]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"voteSum"},r.a.createElement("div",null,"Telah diminta sebanyak:"),r.a.createElement("div",null,m)),r.a.createElement("input",{className:"vote-btn",type:"button",value:g?"Batalkan Request":"+ Request Buku",onClick:j}))},y={toastMsg:"",isShown:!1},S=Object(n.createContext)(y),w=function(e){var t=e.children,a=Object(n.useState)(y),u=Object(c.a)(a,2),i=u[0],s=u[1];return r.a.createElement(S.Provider,{value:{toast:i,showToast:function(e,t){s({toastMsg:e,isShown:!1}),setTimeout((function(){return s({toastMsg:"",isShown:!1})}),2e3)}}},t)},x=function(e){var t=e.book,a=Object(n.useContext)(k).userStatus.uid,u=Object(n.useContext)(S).showToast,i=r.a.useState(!1),s=Object(c.a)(i,2),l=(s[0],s[1],function(){var e=Object(h.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==a){e.next=2;break}return e.abrupt("return",alert("Anda harus sign in sebelum request buku"));case 2:return t.voteSum=1,e.next=5,fetch("https://us-central1-mitranetra-1234.cloudfunctions.net/app/api/add",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({book:t,uid:a})}).then((function(e){return e.json()})).then((function(e){console.log("adding book status:",e),u("Buku berhasil ditambahkan ke daftar request",!1)})).catch((function(e){return console.log("error while adding book:",e)}));case 5:e.sent;case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}());return r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{type:"button",value:"Request Buku",title:"Request buku ini",onClick:l}))},C=function(e){var t=e.book,a=e.detailedInfo,u=e.category,i=function(){for(var e=0,a=["imageLinks","title","subtitle","authors","averageRating","publishedDate","publisher","categories"];e<a.length;e++){var u=a[e];t[u]||(t[u]="-")}var i=function(e){return"-"===e?"-":e.join(", ")},s=t;return r.a.createElement(n.Fragment,null,r.a.createElement("div",null,r.a.createElement("img",{src:s.imageLinks.smallThumbnail,alt:"Gambar Cover untuk ".concat(s.title)})),r.a.createElement("h4",null,s.title),r.a.createElement("p",null,"-"===s.subtitle?"":s.subtitle),r.a.createElement("div",null,"Pengarang: ",i(s.authors),".",r.a.createElement("br",null),"Penerbit: ",s.publisher,".",r.a.createElement("br",null),"Tanggal Terbit: ",s.publishedDate,r.a.createElement("br",null),"Kategori: ",i(s.categories),r.a.createElement("br",null),"Rating: ",s.averageRating+"/5"))}();return r.a.createElement("li",null,i,r.a.createElement(q,{content:t.description}),"bookResult"===u?r.a.createElement(x,{book:a}):null,"reqSection"===u?r.a.createElement(O,{bookInfo:a}):null)},q=function(e){var t=e.content,a=Object(n.useState)(!1),u=Object(c.a)(a,2),i=u[0],s=u[1];return r.a.createElement("div",null,r.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),s(!i)}},i?"Sembunyikan deskripsi":"Lihat deskripsi"),i&&r.a.createElement("p",null,t))},R=function(e){var t=e.category,a=e.data;return r.a.createElement("div",null,r.a.createElement("ul",null,void 0===a.items?"":a.items.map((function(e){return r.a.createElement(C,{key:e.id,book:e.volumeInfo,detailedInfo:e,category:t})}))))},I=a(31),L=a(32),A=a(36),F=a(35),P=(r.a.Component,Object(n.createContext)()),B=function(e){var t=e.children,a=Object(n.useState)({items:[]}),u=Object(c.a)(a,2),i=u[0],s=u[1],l=Object(n.useState)(!1),o=Object(c.a)(l,2),m=o[0],d=o[1];return r.a.createElement(P.Provider,{value:{requestedList:i,isFetched:m,getRequestedList:function(){E.a.firestore().collection("buku").orderBy("voteSum","desc").onSnapshot((function(e){var t=[];e.forEach((function(e){t.push(e.data())})),s({items:t}),console.log(t),d(!0)}),(function(e){d(!1),console.log("error while fetching requestid list:",e)}))}}},t)},V=function(){var e=Object(n.useContext)(P).requestedList,t=Object(n.useContext)(m),a=t.results,u=(t.isLoading,t.fetched,{items:[]}),i={items:[]};return function(){if("undefined"!==typeof a&&a.data.items){var t=a.data.items,n=e.items.filter((function(e,a,n){var r,u=Object(o.a)(t);try{for(u.s();!(r=u.n()).done;){var i=r.value;if(i.id===e.id)return i.status="requested",i}}catch(s){u.e(s)}finally{u.f()}})),r=t.filter((function(e){if("undefined"===typeof e.status)return e}));u.items=n.reverse(),i.items=r}}(),r.a.createElement("div",null,r.a.createElement(f,null),0!==u.items.length?r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"Hasil dari buku yang telah di request"),r.a.createElement(R,{category:"reqSection",data:u})):null,0!==i.items.length?r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"Hasil buku yang belumdi request"),r.a.createElement(R,{category:"bookResult",data:i})):null)},N=a(16),T=function(e){var t=e.onChange,a=e.keywords,u=Object(n.useContext)(m),i=(u.results,u.fetched,u.isLoading,u.getData),s=function(e){var t=new URL("https://www.googleapis.com/books/v1/volumes"),a={q:e,startIndex:0,maxResults:15};return t.search=new URLSearchParams(a).toString(),t};return r.a.createElement("div",null,r.a.createElement("input",{type:"text",name:"keywords",placeholder:"ketik judul dan pengarang untuk hasil lebih akurat",onChange:function(e){return t(e)},onKeyUp:function(e){13===e.keyCode&&i(s,a)},value:a}),r.a.createElement("input",{type:"button",value:"Cari",onClick:i.bind(void 0,s,a)}))},D=function(){var e=Object(n.useContext)(P).requestedList;return r.a.createElement("div",null,r.a.createElement("h2",null,"Buku Paling Banyak Di Request"),r.a.createElement(R,{category:"reqSection",data:e}))},M=a(14),U=function(e){var t=e.activeTab,a=e.userStatus,n=e.isSignedIn,u=n?"admin"===a.role?[{label:"Home",value:1,url:"/"},{label:"Admin Tools",value:2,url:"/admin-tools"},{label:"Sign out",value:3,url:"/sign-out"}]:[{label:"Home",value:1,url:"/"},{label:"My Request List",value:2,url:"/user/requests"},{label:"Sign out",value:3,url:"/sign-out"}]:[{label:"Home",value:1,url:"/"},{label:"Register",value:2,url:"/register"},{label:"Sign in",value:3,url:"/sign-in"}];return r.a.createElement("nav",{className:"tab-manager"},n?"admin"===a.role?r.a.createElement("span",null,"Anda masuk dengan akun ".concat(a.email," sebagai admin")):r.a.createElement("span",null,"Anda masuk dengan akun ".concat(a.email)):r.a.createElement("span",null,"Selamat datang. Silahkan Sign in"),r.a.createElement("ul",null,u.map((function(e){var a=e.label,n=e.value,u=e.url;return r.a.createElement("li",{key:n,className:"tab ".concat(n===t?"selected-tab":"")},r.a.createElement(M.b,{to:u},a))}))))},H=a(11),J=(a(27),function(e){var t=e.history,a=e.message;return setTimeout((function(){return t.push("/")}),1500),r.a.createElement("div",{className:"popup"},r.a.createElement("div",{className:"popup-content"},r.a.createElement("h3",{role:"alert"},a)))}),K=function(e){var t=e.onChange,a=e.history,u=e.email,i=e.password,s=e.sendEmailVerification,l=e.emptyForm,c=Object(n.useContext)(k),o=(c.register,c.registerOnServer),m=c.setAlert,d=c.alertMessage;Object(n.useEffect)((function(){m(""),l()}),[]);var f=function(){var e=Object(h.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,o(u,i,s);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"popup"},r.a.createElement("div",{className:"popup-content"},r.a.createElement("h2",null,"Register dengan Alamat Email dan Password"),r.a.createElement("form",{onSubmit:f,method:"post"},r.a.createElement("label",{htmlFor:"email"},"Email: "),r.a.createElement("input",{id:"email",type:"email",name:"email",autoFocus:!0,placeholder:"abc@example.com",value:u,onChange:t})," ",r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"password"},"Password: "),r.a.createElement("input",{id:"password",type:"password",name:"password",value:i,onChange:t})," ",r.a.createElement("br",null),r.a.createElement("input",{type:"checkbox",id:"sendEV",name:"sendEmailVerification",checked:s,onChange:t}),r.a.createElement("label",{htmlFor:"sendEV"},"Kirimkan Email Verifikasi"),r.a.createElement("p",{role:"alert"},d),r.a.createElement("input",{type:"submit",value:"Register"}),r.a.createElement("input",{type:"button",value:"Close",onClick:function(){return a.goBack()}}))),"success"===d?r.a.createElement(J,{history:a,message:"Registrasi sukses! Anda akan log in secara otomatis."}):null)},W=function(e){var t=e.onChange,a=e.email,u=e.password,i=e.emptyForm,s=e.history,l=Object(n.useContext)(k),c=l.signIn,o=l.alertMessage,m=l.setAlert;Object(n.useEffect)((function(){m(""),i()}),[]);return r.a.createElement("div",{className:"popup"},r.a.createElement("div",{className:"popup-content"},r.a.createElement("h2",null,"Sign in dengan Alamat Email dan Password Anda"),r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),c(a,u)},method:"post"},r.a.createElement("label",{htmlFor:"email"},"Email: "),r.a.createElement("input",{id:"email",type:"email",name:"email",value:a,autoFocus:!0,placeholder:"abc@example.com",onChange:function(e){return t(e)}})," ",r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"password"},"Password: "),r.a.createElement("input",{id:"password",type:"password",name:"password",value:u,onChange:function(e){return t(e)}})," ",r.a.createElement("br",null),r.a.createElement("p",{role:"alert"},o),r.a.createElement("input",{type:"submit",value:"Sign in"}),r.a.createElement("input",{type:"button",value:"Cancel",onClick:function(){return s.goBack()}}))),"success"===o?r.a.createElement(J,{history:s,message:"Sign in sukses!"}):null)},G=function(e){var t=e.history,a=e.signOut,u=e.isSignedIn;return a(),Object(n.useEffect)(Object(h.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.push("/");case 2:window.location.reload(!1);case 3:case"end":return e.stop()}}),e)}))),[u]),r.a.createElement("div",{className:"popup"},r.a.createElement("div",{className:"popup-content"},r.a.createElement("h3",{role:"alert"},"Signing out...")))},z=function(){var e=Object(n.useContext)(S).toast,t=e.toastMsg,a=e.isShown;return r.a.createElement("div",null,r.a.createElement(N.a,{message:t,"aria-live":"assertive"}),a?r.a.createElement("span",{"aria-live":"assertive"},t):null)},X=function(e){var t=e.requestList,a=Object(n.useState)({items:[]}),u=Object(c.a)(a,2),i=u[0],s=u[1],l=[],o=Object(n.useRef)(),m=function(){var e=Object(h.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,E.a.firestore().collection("buku").where("id","in",t).get().then((function(e){e.forEach((function(e){l.unshift(e.data())}))}));case 4:s({items:l});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.useEffect((function(){o.current.focus(),m(t)}),[t]),r.a.createElement(r.a.Fragment,null,r.a.createElement("h2",{tabIndex:0,ref:o},"Daftar Buku yang Anda Request"),r.a.createElement(R,{category:"reqSection",data:i}))},Y=function(){var e=Object(n.useReducer)((function(e,t){return Object(l.a)({},e,{},t)}),{keywords:"",email:"",password:"",sendEmailVerification:!0}),t=Object(c.a)(e,2),a=t[0],u=t[1],i=function(e){var t="sendEmailVerification"===e.target.name?e.target.checked:e.target.value,a=e.target.name;u(Object(s.a)({},a,t))},o=function(){u({keywords:"",email:"",password:""})},d=Object(n.useContext)(P).getRequestedList,f=Object(n.useContext)(m).fetched,p=Object(H.f)(),b=Object(n.useContext)(k),h=b.userStatus,g=b.isSignedIn,E=b.signOut,v=b.checkUserStatus,j=b.requestList,O=b.authCheckDone;return Object(n.useEffect)((function(){v(),d()}),[g]),r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"Request Buku Format EPUB dan Braille"),r.a.createElement(r.a.Fragment,null,O?r.a.createElement(U,{userStatus:h,isSignedIn:g}):null,r.a.createElement("main",null,r.a.createElement(H.c,null,r.a.createElement(H.a,{exact:!0,path:"/"},r.a.createElement(T,{onChange:i,keywords:a.keywords}),f?r.a.createElement(V,null):null,r.a.createElement(D,null)),r.a.createElement(H.a,{path:"/register"},r.a.createElement(K,{onChange:i,emptyForm:o,email:a.email,password:a.password,sendEmailVerification:a.sendEmailVerification,history:p})),r.a.createElement(H.a,{path:"/sign-in"},r.a.createElement(W,{onChange:i,email:a.email,password:a.password,history:p,emptyForm:o})),r.a.createElement(H.a,{path:"/sign-out"},r.a.createElement(G,{history:p,isSignedIn:g,signOut:E})),r.a.createElement(H.a,{path:"/admin-tools"}),r.a.createElement(H.a,{path:"/user/requests"},r.a.createElement(X,{requestList:j})),r.a.createElement(H.a,null,r.a.createElement("h2",null,"Halaman tidak ditemukan."))))),r.a.createElement(z,null))};i.a.render(r.a.createElement(M.a,null,r.a.createElement(d,null,r.a.createElement(B,null,r.a.createElement(j,null,r.a.createElement(w,null,r.a.createElement(Y,null)))))),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.0195b9d6.chunk.js.map